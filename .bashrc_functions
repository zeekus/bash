# User specific aliases and functions
count_http () {
   ps aux| grep -i http| grep -v ps | wc -l
}

most_active_ip () {
 echo "Most active ip at connecting to TCP port 443 :" `date`
 netstat -nat | grep -i :443 | awk '{print $5}' | grep -v "*" | sed -e s/:.*//g | sort | uniq -c | sort -n
}

types_of_connections_443 () {
 echo "types of connections on TCP port 443:" `date`
 netstat -nat | grep -i :443 | awk '{print $6}' | sort | uniq -c | sort -n
}

most_time_waits () {
 echo "TCP timewaits on port 443 at " `date`
 netstat -nat | grep -i :443 | grep -i time | awk '{print $5}' | grep -v "*" | sed -e s/:.*//g | sort | uniq -c | sort -n
}

backup_root_history () {
   mydate=`date +%d_%b_%Y_%H%M`
   sudo cp /root/.bash_history ~/root_history_$mydate
}

load_ssh_agent() {
  ssh-add &>/dev/null || eval `ssh-agent` &>/dev/null  # start ssh-agent if not present
  [ $? -eq 0 ] && {                                     # ssh-agent has started
   ssh-add ~/.ssh/id_dsa &>/dev/null        # Load key 1
   ssh-add ~/.ssh/id_rsa &>/dev/null        # Load key 2
 }
}

top_20_hiters() {
 echo "top 20 hitters from logs today `date +%d/%b/%Y`"
  cat /var/log/httpd/live.access.log | grep `date +%d/%b/%Y` | awk {'print $1'} | sort -n | uniq -c | sort -n | tail -20
} 

getsar () {
#get sar logs 
for x in $(seq 31)
 do
 printf "$x\n"
 if [ $x -lt 10 ]; then
   LC_ALL=C sar -A -f /var/log/sa/sa0$x > sa0$x.txt
 else
   LC_ALL=C sar -A -f /var/log/sa/sa$x > sa$x.txt
 fi
 done
}
